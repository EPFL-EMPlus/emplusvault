FROM postgis/postgis:14-master
RUN apt-get update && apt-get install -y git make gcc postgresql-server-dev-14 postgresql-14-pgvector
RUN mkdir /home/postgres
RUN chown postgres:postgres /home/postgres
RUN chown postgres:postgres /usr/lib/postgresql/ -R
RUN chown postgres:postgres /usr/share/postgresql/14/extension/

RUN echo "listen_addresses = '*'" >> /var/lib/postgresql/data/postgresql.conf
RUN echo "host all all 0.0.0.0/0 md5" >> /var/lib/postgresql/data/pg_hba.conf

# Copy in the load-extensions script
COPY load-extensions.sh /docker-entrypoint-initdb.d
