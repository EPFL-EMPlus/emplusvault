FROM postgis/postgis:16-master
RUN apt-get update && apt-get install -y git make gcc postgresql-server-dev-16 postgresql-16-pgvector
RUN mkdir -p /home/postgres && \
    chown postgres:postgres /home/postgres && \
    chown -R postgres:postgres /usr/lib/postgresql/ && \
    chown -R postgres:postgres /usr/share/postgresql/16/extension/ && \
    mkdir -p /usr/include/postgresql/16/server/extension/vector/ && \
    chown -R postgres:postgres /usr/include/postgresql/16/

RUN echo "listen_addresses = '*'" >> /var/lib/postgresql/data/postgresql.conf
RUN echo "host all all 0.0.0.0/0 md5" >> /var/lib/postgresql/data/pg_hba.conf

# Copy in the load-extensions script
COPY load-extensions.sh /docker-entrypoint-initdb.d/

